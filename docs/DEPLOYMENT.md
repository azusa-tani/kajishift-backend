# KAJISHIFT ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰API ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã‚¬ã‚¤ãƒ‰

## ğŸ“‹ ç›®æ¬¡

1. [ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆæ–¹æ³•ã®é¸æŠ](#ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆæ–¹æ³•ã®é¸æŠ)
2. [æœ¬ç•ªç’°å¢ƒã¸ã®æº–å‚™](#æœ¬ç•ªç’°å¢ƒã¸ã®æº–å‚™)
3. [ç’°å¢ƒå¤‰æ•°ã®è¨­å®š](#ç’°å¢ƒå¤‰æ•°ã®è¨­å®š)
4. [ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—](#ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—)
5. [ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ‡ãƒ—ãƒ­ã‚¤](#ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ‡ãƒ—ãƒ­ã‚¤)
6. [ãƒ—ãƒ­ã‚»ã‚¹ç®¡ç†ï¼ˆPM2ï¼‰](#ãƒ—ãƒ­ã‚»ã‚¹ç®¡ç†pm2)
7. [ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·ï¼ˆNginxï¼‰](#ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·nginx)
8. [SSL/TLSè¨¼æ˜æ›¸ã®è¨­å®š](#ssltlsè¨¼æ˜æ›¸ã®è¨­å®š)
9. [ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ åˆ¥ã®ãƒ‡ãƒ—ãƒ­ã‚¤](#ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ åˆ¥ã®ãƒ‡ãƒ—ãƒ­ã‚¤)
10. [ç›£è¦–ã¨ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹](#ç›£è¦–ã¨ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹)

## ğŸ¯ ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆæ–¹æ³•ã®é¸æŠ

KAJISHIFTãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIã‚’Webã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹æ–¹æ³•ã¯è¤‡æ•°ã‚ã‚Šã¾ã™ã€‚ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®è¦æ¨¡ã€äºˆç®—ã€æŠ€è¡“ã‚¹ã‚­ãƒ«ã«å¿œã˜ã¦æœ€é©ãªæ–¹æ³•ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚

### ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆæ–¹æ³•ã®æ¯”è¼ƒ

| æ–¹æ³• | é›£æ˜“åº¦ | ã‚³ã‚¹ãƒˆ | ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£ | æ¨å¥¨å¯¾è±¡ |
|------|--------|--------|------------------|----------|
| **ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ** | â­ ç°¡å˜ | ç„¡æ–™æ ã‚ã‚Š | ä¸­ | åˆå¿ƒè€…ãƒ»å°è¦æ¨¡ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ |
| **VPS + PM2 + Nginx** | â­â­ ä¸­ç´š | ä½ã€œä¸­ | é«˜ | ä¸­ç´šè€…ãƒ»ä¸­è¦æ¨¡ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ |
| **ã‚³ãƒ³ãƒ†ãƒŠã‚µãƒ¼ãƒ“ã‚¹** | â­â­â­ ä¸Šç´š | ä¸­ã€œé«˜ | éå¸¸ã«é«˜ | ä¸Šç´šè€…ãƒ»å¤§è¦æ¨¡ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ |

### 1. ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ï¼ˆåˆå¿ƒè€…å‘ã‘ãƒ»æ¨å¥¨ï¼‰

**ç‰¹å¾´:**
- âœ… ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãŒç°¡å˜
- âœ… ç„¡æ–™æ ãŒã‚ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ãŒå¤šã„
- âœ… Gité€£æºã§è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤
- âœ… ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚‚æä¾›
- âœ… SSLè¨¼æ˜æ›¸ãŒè‡ªå‹•è¨­å®š

**æ¨å¥¨ã‚µãƒ¼ãƒ“ã‚¹:**
- **Railway** - ç„¡æ–™æ ã‚ã‚Šã€éå¸¸ã«ç°¡å˜
- **Render** - ç„¡æ–™æ ã‚ã‚Šã€ã‚·ãƒ³ãƒ—ãƒ«
- **Heroku** - æœ‰æ–™ãƒ—ãƒ©ãƒ³ãŒå¿…è¦ã ãŒå®‰å®š
- **Fly.io** - ç„¡æ–™æ ã‚ã‚Šã€é«˜é€Ÿ

**é©ã—ã¦ã„ã‚‹å ´åˆ:**
- åˆã‚ã¦ã®ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ
- å°è¦æ¨¡ã€œä¸­è¦æ¨¡ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ
- è¿…é€Ÿãªãƒ‡ãƒ—ãƒ­ã‚¤ãŒå¿…è¦
- ã‚µãƒ¼ãƒãƒ¼ç®¡ç†ã‚’é¿ã‘ãŸã„

### 2. VPS + PM2 + Nginxï¼ˆä¸­ç´šè€…å‘ã‘ï¼‰

**ç‰¹å¾´:**
- âœ… ã‚³ã‚¹ãƒˆåŠ¹ç‡ãŒè‰¯ã„
- âœ… å®Œå…¨ãªåˆ¶å¾¡ãŒå¯èƒ½
- âœ… ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºæ€§ãŒé«˜ã„
- âš ï¸ ã‚µãƒ¼ãƒãƒ¼ç®¡ç†ãŒå¿…è¦
- âš ï¸ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šãŒå¿…è¦

**æ¨å¥¨ã‚µãƒ¼ãƒ“ã‚¹:**
- **AWS EC2** - ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºå‘ã‘
- **DigitalOcean** - ã‚·ãƒ³ãƒ—ãƒ«ã§åˆ†ã‹ã‚Šã‚„ã™ã„
- **Vultr** - ã‚³ã‚¹ãƒˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒè‰¯ã„
- **ConoHa VPS** - æ—¥æœ¬å›½å†…ã‚µãƒ¼ãƒãƒ¼
- **ã•ãã‚‰ã®VPS** - æ—¥æœ¬å›½å†…ã‚µãƒ¼ãƒãƒ¼

**é©ã—ã¦ã„ã‚‹å ´åˆ:**
- ã‚µãƒ¼ãƒãƒ¼ç®¡ç†ã®çµŒé¨“ãŒã‚ã‚‹
- ã‚³ã‚¹ãƒˆã‚’æŠ‘ãˆãŸã„
- ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºãŒå¿…è¦
- ä¸­è¦æ¨¡ã€œå¤§è¦æ¨¡ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ

### 3. ã‚³ãƒ³ãƒ†ãƒŠã‚µãƒ¼ãƒ“ã‚¹ï¼ˆä¸Šç´šè€…å‘ã‘ï¼‰

**ç‰¹å¾´:**
- âœ… éå¸¸ã«ã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«
- âœ… ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹å¯¾å¿œ
- âœ… é«˜å¯ç”¨æ€§
- âš ï¸ è¤‡é›‘ãªè¨­å®šãŒå¿…è¦
- âš ï¸ é‹ç”¨ã‚³ã‚¹ãƒˆãŒé«˜ã„

**æ¨å¥¨ã‚µãƒ¼ãƒ“ã‚¹:**
- **AWS ECS/Fargate** - AWSã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ 
- **Google Cloud Run** - ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ã‚³ãƒ³ãƒ†ãƒŠ
- **Azure Container Instances** - Azureã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ 
- **Kubernetes** - å¤§è¦æ¨¡é‹ç”¨å‘ã‘

**é©ã—ã¦ã„ã‚‹å ´åˆ:**
- å¤§è¦æ¨¡ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ
- é«˜å¯ç”¨æ€§ãŒå¿…è¦
- ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
- ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºç’°å¢ƒ

### æ¨å¥¨ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆæ–¹æ³•

#### ğŸŸ¢ åˆå¿ƒè€…å‘ã‘: Railway ã¾ãŸã¯ Render

**ç†ç”±:**
- ç„¡æ–™æ ãŒã‚ã‚‹
- Gité€£æºã§è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚‚æä¾›
- SSLè¨¼æ˜æ›¸ãŒè‡ªå‹•è¨­å®š
- ã‚µãƒ¼ãƒãƒ¼ç®¡ç†ä¸è¦

**è©³ç´°ãªæ‰‹é †ã¯ã€Œ[ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ åˆ¥ã®ãƒ‡ãƒ—ãƒ­ã‚¤](#ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ åˆ¥ã®ãƒ‡ãƒ—ãƒ­ã‚¤)ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚**

#### ğŸŸ¡ ä¸­ç´šè€…å‘ã‘: VPS + Docker

**ç†ç”±:**
- ã‚³ã‚¹ãƒˆåŠ¹ç‡ãŒè‰¯ã„
- æŸ”è»Ÿãªè¨­å®šãŒå¯èƒ½
- ã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«
- å­¦ç¿’ä¾¡å€¤ãŒé«˜ã„

**è©³ç´°ãªæ‰‹é †ã¯ã€Œ[æœ¬ç•ªç’°å¢ƒã¸ã®æº–å‚™](#æœ¬ç•ªç’°å¢ƒã¸ã®æº–å‚™)ã€ä»¥é™ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚**

#### ğŸ”´ ä¸Šç´šè€…å‘ã‘: AWS/GCP/Azure

**ç†ç”±:**
- ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºå‘ã‘
- é«˜å¯ç”¨æ€§
- é«˜åº¦ãªç›£è¦–æ©Ÿèƒ½
- ã‚°ãƒ­ãƒ¼ãƒãƒ«å±•é–‹ã«å¯¾å¿œ

---

## ğŸš€ æœ¬ç•ªç’°å¢ƒã¸ã®æº–å‚™

### 1. å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
npm install
```

### 2. ç’°å¢ƒå¤‰æ•°ã®è¨­å®š

`.env.example`ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦`.env`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã€æœ¬ç•ªç’°å¢ƒç”¨ã®å€¤ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚

```bash
cp .env.example .env
```

### 3. å¿…é ˆç’°å¢ƒå¤‰æ•°ã®ç¢ºèª

ä»¥ä¸‹ã®ç’°å¢ƒå¤‰æ•°ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š

- `DATABASE_URL` - PostgreSQLæ¥ç¶šURL
- `JWT_SECRET` - 32æ–‡å­—ä»¥ä¸Šã®å¼·åŠ›ãªãƒ©ãƒ³ãƒ€ãƒ æ–‡å­—åˆ—
- `PORT` - ã‚µãƒ¼ãƒãƒ¼ãƒãƒ¼ãƒˆï¼ˆé€šå¸¸ã¯3000ï¼‰
- `NODE_ENV` - `production`ã«è¨­å®š

## ğŸ” ç’°å¢ƒå¤‰æ•°ã®è¨­å®š

### æœ¬ç•ªç’°å¢ƒç”¨ã®æ¨å¥¨è¨­å®š

```env
# ã‚µãƒ¼ãƒãƒ¼è¨­å®š
NODE_ENV=production
PORT=3000

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
DATABASE_URL="postgresql://user:password@host:5432/kajishift?schema=public"

# JWTèªè¨¼ï¼ˆ32æ–‡å­—ä»¥ä¸Šã®å¼·åŠ›ãªãƒ©ãƒ³ãƒ€ãƒ æ–‡å­—åˆ—ï¼‰
JWT_SECRET=å¼·åŠ›ãªãƒ©ãƒ³ãƒ€ãƒ æ–‡å­—åˆ—ï¼ˆæœ€ä½32æ–‡å­—ä»¥ä¸Šï¼‰
JWT_EXPIRES_IN=1h

# ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥
BCRYPT_ROUNDS=12

# CORSè¨­å®š
CORS_ORIGIN=https://your-production-domain.com

# ãƒ¡ãƒ¼ãƒ«é€ä¿¡è¨­å®š
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your-email@gmail.com
SMTP_PASS=your-app-password
SMTP_FROM=noreply@kajishift.com

# ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰URL
FRONTEND_URL=https://your-production-domain.com

# ãƒ­ã‚®ãƒ³ã‚°
LOG_LEVEL=info
```

## ğŸ—„ï¸ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### 1. ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®å®Ÿè¡Œ

```bash
# æœ¬ç•ªç’°å¢ƒç”¨ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
npm run prisma:migrate:deploy

# Prismaã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ç”Ÿæˆ
npm run prisma:generate
```

### 2. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã®è¨­å®š

å®šæœŸçš„ãªãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’è¨­å®šã—ã¦ãã ã•ã„ï¼š

```bash
# ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ä¾‹
pg_dump -h localhost -U postgres -d kajishift > backup_$(date +%Y%m%d_%H%M%S).sql
```

## ğŸ“¦ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ‡ãƒ—ãƒ­ã‚¤

### 1. ã‚³ãƒ¼ãƒ‰ã®ãƒ‡ãƒ—ãƒ­ã‚¤

```bash
# Gitã‹ã‚‰æœ€æ–°ã®ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—
git pull origin main

# ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install --production

# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®å®Ÿè¡Œ
npm run prisma:migrate:deploy
npm run prisma:generate
```

### 2. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®èµ·å‹•

```bash
# é–‹ç™ºç’°å¢ƒ
npm run dev

# æœ¬ç•ªç’°å¢ƒï¼ˆPM2ã‚’ä½¿ç”¨ï¼‰
pm2 start ecosystem.config.js
```

## ğŸ”„ ãƒ—ãƒ­ã‚»ã‚¹ç®¡ç†ï¼ˆPM2ï¼‰

### PM2ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
npm install -g pm2
```

### PM2ã®ä½¿ç”¨æ–¹æ³•

```bash
# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®èµ·å‹•
pm2 start ecosystem.config.js

# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®åœæ­¢
pm2 stop kajishift-api

# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å†èµ·å‹•
pm2 restart kajishift-api

# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å‰Šé™¤
pm2 delete kajishift-api

# ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®ç¢ºèª
pm2 status

# ãƒ­ã‚°ã®ç¢ºèª
pm2 logs kajishift-api

# ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•æ™‚ã«è‡ªå‹•èµ·å‹•
pm2 save
pm2 startup
```

### PM2ã®ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°

```bash
# ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°
pm2 monit

# è©³ç´°æƒ…å ±ã®è¡¨ç¤º
pm2 show kajishift-api
```

## ğŸŒ ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·ï¼ˆNginxï¼‰

### Nginxè¨­å®šä¾‹

```nginx
# HTTPã‹ã‚‰HTTPSã¸ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
server {
    listen 80;
    server_name api.kajishift.com;
    
    return 301 https://$server_name$request_uri;
}

# HTTPSè¨­å®š
server {
    listen 443 ssl http2;
    server_name api.kajishift.com;
    
    # SSLè¨¼æ˜æ›¸ã®ãƒ‘ã‚¹
    ssl_certificate /etc/letsencrypt/live/api.kajishift.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/api.kajishift.com/privkey.pem;
    
    # SSLè¨­å®š
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;
    ssl_prefer_server_ciphers on;
    
    # ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;
    
    # ãƒ­ã‚°è¨­å®š
    access_log /var/log/nginx/kajishift-api-access.log;
    error_log /var/log/nginx/kajishift-api-error.log;
    
    # ãƒ—ãƒ­ã‚­ã‚·è¨­å®š
    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
        
        # ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®š
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }
    
    # ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚µã‚¤ã‚ºåˆ¶é™
    client_max_body_size 10M;
}
```

### Nginxã®å†èµ·å‹•

```bash
sudo nginx -t  # è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®æ§‹æ–‡ãƒã‚§ãƒƒã‚¯
sudo systemctl reload nginx  # è¨­å®šã®å†èª­ã¿è¾¼ã¿
```

## ğŸ”’ SSL/TLSè¨¼æ˜æ›¸ã®è¨­å®š

### Let's Encryptã‚’ä½¿ç”¨ã—ãŸè¨¼æ˜æ›¸ã®å–å¾—

```bash
# Certbotã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
sudo apt-get update
sudo apt-get install certbot python3-certbot-nginx

# è¨¼æ˜æ›¸ã®å–å¾—
sudo certbot --nginx -d api.kajishift.com

# è‡ªå‹•æ›´æ–°ã®ç¢ºèª
sudo certbot renew --dry-run
```

## â˜ï¸ ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ åˆ¥ã®ãƒ‡ãƒ—ãƒ­ã‚¤

### Railwayï¼ˆæ¨å¥¨ï¼šåˆå¿ƒè€…å‘ã‘ï¼‰

Railwayã¯æœ€ã‚‚ç°¡å˜ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã§ãã‚‹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®ä¸€ã¤ã§ã™ã€‚

#### 1. Railwayã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ä½œæˆ

1. [Railway](https://railway.app/)ã«ã‚¢ã‚¯ã‚»ã‚¹
2. GitHubã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—

#### 2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ

1. ã€ŒNew Projectã€ã‚’ã‚¯ãƒªãƒƒã‚¯
2. ã€ŒDeploy from GitHub repoã€ã‚’é¸æŠ
3. ãƒªãƒã‚¸ãƒˆãƒªã‚’é¸æŠ

#### 3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®è¿½åŠ 

1. ã€ŒNewã€â†’ã€ŒDatabaseã€â†’ã€ŒAdd PostgreSQLã€ã‚’é¸æŠ
2. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒè‡ªå‹•çš„ã«ä½œæˆã•ã‚Œã‚‹
3. `DATABASE_URL`ç’°å¢ƒå¤‰æ•°ãŒè‡ªå‹•è¨­å®šã•ã‚Œã‚‹

#### 4. ç’°å¢ƒå¤‰æ•°ã®è¨­å®š

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã€ŒVariablesã€ã‚¿ãƒ–ã§ä»¥ä¸‹ã‚’è¨­å®šï¼š

```env
NODE_ENV=production
JWT_SECRET=32æ–‡å­—ä»¥ä¸Šã®å¼·åŠ›ãªãƒ©ãƒ³ãƒ€ãƒ æ–‡å­—åˆ—
CORS_ORIGIN=https://your-frontend-domain.com
PORT=3000
```

#### 5. ãƒ“ãƒ«ãƒ‰ã‚³ãƒãƒ³ãƒ‰ã®è¨­å®š

ã€ŒSettingsã€â†’ã€ŒBuild Commandã€ã«ä»¥ä¸‹ã‚’è¨­å®šï¼š

```bash
npm install && npm run prisma:generate
```

#### 6. èµ·å‹•ã‚³ãƒãƒ³ãƒ‰ã®è¨­å®š

ã€ŒSettingsã€â†’ã€ŒStart Commandã€ã«ä»¥ä¸‹ã‚’è¨­å®šï¼š

```bash
npm run prisma:migrate:deploy && npm start
```

#### 7. ãƒ‡ãƒ—ãƒ­ã‚¤

- Gitã«ãƒ—ãƒƒã‚·ãƒ¥ã™ã‚‹ã¨è‡ªå‹•çš„ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã¾ã™
- ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã€URLãŒè‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã™ï¼ˆä¾‹: `https://your-project.up.railway.app`ï¼‰

#### 8. ã‚«ã‚¹ã‚¿ãƒ ãƒ‰ãƒ¡ã‚¤ãƒ³ã®è¨­å®šï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

1. ã€ŒSettingsã€â†’ã€ŒDomainsã€ã§ã‚«ã‚¹ã‚¿ãƒ ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’è¿½åŠ 
2. DNSè¨­å®šã‚’Railwayã®æŒ‡ç¤ºã«å¾“ã£ã¦è¨­å®š

---

### Render

Renderã‚‚åˆå¿ƒè€…å‘ã‘ã®ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§ã™ã€‚

#### 1. Renderã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ä½œæˆ

1. [Render](https://render.com/)ã«ã‚¢ã‚¯ã‚»ã‚¹
2. GitHubã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—

#### 2. Webã‚µãƒ¼ãƒ“ã‚¹ã®ä½œæˆ

1. ã€ŒNew +ã€â†’ã€ŒWeb Serviceã€ã‚’é¸æŠ
2. ãƒªãƒã‚¸ãƒˆãƒªã‚’æ¥ç¶š
3. ä»¥ä¸‹ã®è¨­å®šã‚’è¡Œã†ï¼š
   - **Name**: `kajishift-api`
   - **Environment**: `Node`
   - **Build Command**: `npm install && npm run prisma:generate`
   - **Start Command**: `npm run prisma:migrate:deploy && npm start`
   - **Plan**: Freeï¼ˆç„¡æ–™ãƒ—ãƒ©ãƒ³ï¼‰

#### 3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ä½œæˆ

1. ã€ŒNew +ã€â†’ã€ŒPostgreSQLã€ã‚’é¸æŠ
2. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åã‚’è¨­å®š
3. `DATABASE_URL`ç’°å¢ƒå¤‰æ•°ãŒè‡ªå‹•è¨­å®šã•ã‚Œã‚‹

#### 4. ç’°å¢ƒå¤‰æ•°ã®è¨­å®š

ã€ŒEnvironmentã€ã‚¿ãƒ–ã§ä»¥ä¸‹ã‚’è¨­å®šï¼š

```env
NODE_ENV=production
JWT_SECRET=32æ–‡å­—ä»¥ä¸Šã®å¼·åŠ›ãªãƒ©ãƒ³ãƒ€ãƒ æ–‡å­—åˆ—
CORS_ORIGIN=https://your-frontend-domain.com
```

#### 5. ãƒ‡ãƒ—ãƒ­ã‚¤

- ã€ŒManual Deployã€ã§æ‰‹å‹•ãƒ‡ãƒ—ãƒ­ã‚¤ã€ã¾ãŸã¯
- Gitã«ãƒ—ãƒƒã‚·ãƒ¥ã™ã‚‹ã¨è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤

---

### Heroku

Herokuã¯å®‰å®šæ€§ãŒé«˜ã„ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§ã™ãŒã€æœ‰æ–™ãƒ—ãƒ©ãƒ³ãŒå¿…è¦ã§ã™ã€‚

#### 1. Herokuã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ä½œæˆ

1. [Heroku](https://www.heroku.com/)ã«ã‚¢ã‚¯ã‚»ã‚¹
2. ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆ

#### 2. Heroku CLIã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
# macOS
brew tap heroku/brew && brew install heroku

# Windows
# https://devcenter.heroku.com/articles/heroku-cli ã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
```

#### 3. ãƒ­ã‚°ã‚¤ãƒ³

```bash
heroku login
```

#### 4. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ä½œæˆ

```bash
cd kajishift-backend
heroku create kajishift-api
```

#### 5. PostgreSQLã‚¢ãƒ‰ã‚ªãƒ³ã®è¿½åŠ 

```bash
heroku addons:create heroku-postgresql:hobby-dev
```

#### 6. ç’°å¢ƒå¤‰æ•°ã®è¨­å®š

```bash
heroku config:set NODE_ENV=production
heroku config:set JWT_SECRET=32æ–‡å­—ä»¥ä¸Šã®å¼·åŠ›ãªãƒ©ãƒ³ãƒ€ãƒ æ–‡å­—åˆ—
heroku config:set CORS_ORIGIN=https://your-frontend-domain.com
```

#### 7. Prismaã®è¨­å®š

`package.json`ã«ä»¥ä¸‹ã‚’è¿½åŠ ï¼š

```json
{
  "scripts": {
    "postinstall": "prisma generate",
    "prisma:migrate:deploy": "prisma migrate deploy"
  }
}
```

#### 8. ãƒ‡ãƒ—ãƒ­ã‚¤

```bash
git push heroku main
```

#### 9. ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®å®Ÿè¡Œ

```bash
heroku run npm run prisma:migrate:deploy
```

---

### Fly.io

Fly.ioã¯é«˜é€Ÿã§ã‚°ãƒ­ãƒ¼ãƒãƒ«ãªãƒ‡ãƒ—ãƒ­ã‚¤ãŒå¯èƒ½ã§ã™ã€‚

#### 1. Fly.ioã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ä½œæˆ

1. [Fly.io](https://fly.io/)ã«ã‚¢ã‚¯ã‚»ã‚¹
2. ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆ

#### 2. Fly.io CLIã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
# macOS/Linux
curl -L https://fly.io/install.sh | sh

# Windows
# https://fly.io/docs/hands-on/install-flyctl/ ã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
```

#### 3. ãƒ­ã‚°ã‚¤ãƒ³

```bash
flyctl auth login
```

#### 4. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®åˆæœŸåŒ–

```bash
cd kajishift-backend
flyctl launch
```

#### 5. PostgreSQLãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ä½œæˆ

```bash
flyctl postgres create
```

#### 6. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®æ¥ç¶š

```bash
flyctl postgres attach <database-name>
```

#### 7. ç’°å¢ƒå¤‰æ•°ã®è¨­å®š

`fly.toml`ã«ä»¥ä¸‹ã‚’è¿½åŠ ï¼š

```toml
[env]
  NODE_ENV = "production"
  JWT_SECRET = "32æ–‡å­—ä»¥ä¸Šã®å¼·åŠ›ãªãƒ©ãƒ³ãƒ€ãƒ æ–‡å­—åˆ—"
  CORS_ORIGIN = "https://your-frontend-domain.com"
```

#### 8. ãƒ‡ãƒ—ãƒ­ã‚¤

```bash
flyctl deploy
```

---

### ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ å…±é€šã®æ³¨æ„äº‹é …

1. **ç’°å¢ƒå¤‰æ•°ã®ç®¡ç†**
   - æ©Ÿå¯†æƒ…å ±ã¯ç’°å¢ƒå¤‰æ•°ã§ç®¡ç†
   - `.env`ãƒ•ã‚¡ã‚¤ãƒ«ã¯Gitã«ã‚³ãƒŸãƒƒãƒˆã—ãªã„

2. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³**
   - åˆå›ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã«ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œ
   - å¤šãã®ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§è‡ªå‹•å®Ÿè¡Œã•ã‚Œã‚‹

3. **ãƒ­ã‚°ã®ç¢ºèª**
   - å„ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ãƒ­ã‚°ã‚’ç¢ºèª
   - ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆã¯ãƒ­ã‚°ã‚’ç¢ºèª

4. **ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°**
   - ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã«å¿œã˜ã¦ã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ãƒƒãƒ—/ãƒ€ã‚¦ãƒ³
   - ç„¡æ–™ãƒ—ãƒ©ãƒ³ã«ã¯åˆ¶é™ãŒã‚ã‚‹

5. **ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—**
   - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’å®šæœŸçš„ã«å–å¾—
   - å¤šãã®ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãŒæä¾›ã•ã‚Œã‚‹

---

## ğŸ“Š ç›£è¦–ã¨ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹

### ãƒ­ã‚°ã®ç¢ºèª

```bash
# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚°
tail -f logs/combined.log
tail -f logs/error.log

# PM2ãƒ­ã‚°
pm2 logs kajishift-api

# Nginxãƒ­ã‚°
sudo tail -f /var/log/nginx/kajishift-api-access.log
sudo tail -f /var/log/nginx/kajishift-api-error.log
```

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°

```bash
# PM2ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°
pm2 monit

# ã‚·ã‚¹ãƒ†ãƒ ãƒªã‚½ãƒ¼ã‚¹ã®ç¢ºèª
htop
df -h  # ãƒ‡ã‚£ã‚¹ã‚¯ä½¿ç”¨é‡
free -h  # ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡
```

### ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯

```bash
# ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
curl https://api.kajishift.com/api/health
```

## ğŸ”„ ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆæ‰‹é †

### é€šå¸¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ

1. **ã‚³ãƒ¼ãƒ‰ã®å–å¾—**
   ```bash
   git pull origin main
   ```

2. **ä¾å­˜é–¢ä¿‚ã®æ›´æ–°**
   ```bash
   npm install --production
   ```

3. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³**
   ```bash
   npm run prisma:migrate:deploy
   npm run prisma:generate
   ```

4. **ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å†èµ·å‹•**
   ```bash
   pm2 restart kajishift-api
   ```

5. **å‹•ä½œç¢ºèª**
   ```bash
   curl https://api.kajishift.com/api/health
   ```

### ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ‰‹é †

1. **å‰ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«æˆ»ã™**
   ```bash
   git checkout <previous-commit-hash>
   ```

2. **ä¾å­˜é–¢ä¿‚ã®å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«**
   ```bash
   npm install --production
   ```

3. **ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å†èµ·å‹•**
   ```bash
   pm2 restart kajishift-api
   ```

## âš ï¸ æ³¨æ„äº‹é …

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

- `.env`ãƒ•ã‚¡ã‚¤ãƒ«ã¯çµ¶å¯¾ã«Gitã«ã‚³ãƒŸãƒƒãƒˆã—ãªã„
- `JWT_SECRET`ã¯32æ–‡å­—ä»¥ä¸Šã®å¼·åŠ›ãªãƒ©ãƒ³ãƒ€ãƒ æ–‡å­—åˆ—ã«è¨­å®š
- å®šæœŸçš„ã«ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã‚’å®Ÿæ–½
- ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã«æ©Ÿå¯†æƒ…å ±ã‚’å‡ºåŠ›ã—ãªã„

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹

- å®šæœŸçš„ã«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®æœ€é©åŒ–ã‚’å®Ÿæ–½
- ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¨­å®š
- ãƒ‡ã‚£ã‚¹ã‚¯å®¹é‡ã‚’ç›£è¦–

### ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—

- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®å®šæœŸçš„ãªãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’å®Ÿæ–½
- ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‹ã‚‰ã®å¾©æ—§æ‰‹é †ã‚’æ–‡æ›¸åŒ–
- ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã®ä¿å­˜æœŸé–“ã‚’è¨­å®š

## ğŸ“š é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [HANDOVER_PROMPT.md](./HANDOVER_PROMPT.md) - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå¼•ç¶™ããƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- [DATABASE_SETUP.md](./DATABASE_SETUP.md) - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¬ã‚¤ãƒ‰
- [HANDOVER_COMPLETE.md](./HANDOVER_COMPLETE.md) - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå¼•ç¶™ãå®Œäº†ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ